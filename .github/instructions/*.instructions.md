# MiTG Forge · Instruções de Arquitetura & Código

Este documento explica como o backend do **MiTG Forge** (site de Tibia) é organizado e como contribuir seguindo o padrão do projeto.

---

## Stack Principal

- **Runtime:** [Bun](https://bun.sh)
- **HTTP Server:** [Hono](https://hono.dev)
- **RPC:** [ORPC](https://github.com/orpc)
- **Validação & Schemas:** [Zod](https://zod.dev)
- **Injeção de Dependência:** [tsyringe](https://github.com/microsoft/tsyringe)
- **Linguagem:** TypeScript

> **Fluxo padrão:**  
> `Route → UseCase → Service → Repository → Client`  
> Tudo costurado por **tsyringe** e tipado com **Zod + ORPC**.

---

## Organização do Monorepo

Estrutura simplificada do repositório:

```plaintext
apps/
  api/            # Backend: Bun + Hono + ORPC
  web/            # Frontend: React + Vite + TanStack Router + React Query

packages/
  core/           # Tipos compartilhados, schemas Zod e utilitários
  emails/         # Templates de e-mail
  ...             # Outros pacotes compartilhados
```

---

## Padrão Arquitetural

### Camadas e Responsabilidades

#### 1. **Route** (`src/routes/**`)
- **Responsabilidade:** Converte HTTP/RPC em chamadas de UseCase.
- **Tarefas:**
  - Faz o parse e validação de entrada com **Zod**.
  - Mapeia erros para respostas HTTP/ORPC.
- **Regra:** Não contém lógica de negócio.

---

#### 2. **UseCase** (`src/application/usecases`)
- **Responsabilidade:** Orquestra cenários específicos (ex.: `CreateAccount`, `ChangePassword`, `EnableTwoFactor`).
- **Tarefas:**
  - Usa **services** para executar regras de negócio.
  - Utiliza **tsyringe** para injeção de dependências.

---

#### 3. **Service** (`src/application/services`)
- **Responsabilidade:** Implementa regras de negócio reutilizáveis.
- **Tarefas:**
  - Pode chamar múltiplos **repositories** e **clients**.
  - Não conhece detalhes de HTTP, Hono, ORPC, etc.

---

#### 4. **Repository**
- **Implementação:** `src/domain/repositories`
- **Responsabilidade:** Gerencia persistência (banco de dados, cache, etc.).
- **Exemplo:** Implementação concreta usando **Prisma**.

---

#### 5. **Client**
- **Implementação:** `src/domain/clients`
- **Responsabilidade:** Gerencia comunicação com APIs externas (ex.: Discord, GitLab).

---

#### 6. **DI Container** (`src/infra/di`)
- **Responsabilidade:** Configura e registra dependências no container do **tsyringe**.
- **Registra:**
  - Clients (ex.: `DiscordClient`).
  - Repositories.
  - Services.
  - UseCases.
  - Infraestrutura (ex.: logger, Prisma, Redis).
- **Exposição:** Disponibilizado para Hono/ORPC via `ExecutionContext`.

---

## Resumo do Fluxo

1. **Route:** Recebe a requisição e valida os dados com Zod.
2. **UseCase:** Orquestra o caso de uso, chamando os serviços necessários.
3. **Service:** Implementa as regras de negócio.
4. **Repository:** Gerencia persistência (banco, cache, etc.).
5. **Client:** Faz chamadas a APIs externas.

---

## Boas Práticas

- **Mantenha o código modular:** Cada camada deve ter uma responsabilidade clara.
- **Evite lógica duplicada:** Reutilize serviços e utilitários sempre que possível.
- **Escreva testes:** Priorize testes unitários para UseCases e Services.
- **Documente:** Adicione comentários claros em partes complexas do código.

---

Com essas instruções, o projeto se mantém organizado, escalável e fácil de contribuir.